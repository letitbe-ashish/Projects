<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Help - CityZen</title>


  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@100;900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />


  <script src="https://cdn.tailwindcss.com"></script>


  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
  <div class="grid-container">

    <!-- Header -->
    <header class="header">
      <div class="menu-icon">
        <i id="bar" class="fa-solid fa-bars fa-xl"></i>
      </div>
      <div class="header-right">
        <i id="accountBtn" class="fa-solid fa-user fa-xl"></i>
        <a href="{{ url_for('message') }}"><i class="fa-solid fa-envelope fa-xl"></i></a>
      </div>
    </header>

    <!-- Account Panel -->
    <div id="accountPanel" class="account-panel ">
      <div class="slide-content">
        <div class="profile-section">
          <img class="profile-img" src="{{ url_for('static', filename='images/images.jpg') }}" />
          <div class="userdetail">
            <h2 class="profile-name">{{ username }}</h2>
            <p class="profile-email">{{ email }}</p>
          </div>
        </div>
        <hr class="divider" />
        <div class="section">
          <form action="{{ url_for('logout') }}" method="post">
            <button type="submit" class="logout">

              <span class="left"><i class="fa-solid fa-right-from-bracket icon"></i> Log Out</span>
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <aside id="sidebar">
      <div class="sidebar-title">
        <div class="sidebar-brand">
          <img src="{{ url_for('static', filename='images/logo-gold.png') }}" />
        </div>
      </div>

      <ul class="sidebar-list">
        <li class="sidebar-list-item">
          <a href="{{ url_for('dashboard') }}"><i class="fa-solid fa-table-columns"></i> Dashboard</a>
        </li>
        <li class="sidebar-list-item">
          <a href="{{ url_for('hotissue') }}"><i class="fa-solid fa-list-ol fa-l"></i> Hot Issues</a>
        </li>
        <li class="sidebar-list-item">
          <a href="{{ url_for('reportform') }}"><i class="fa-solid fa-box-tissue"></i> Report An Issue</a>
        </li>
        <li class="sidebar-list-item">
          <a href="{{ url_for('trackissue') }}"><i class="fa-solid fa-thumbtack"></i> Track Issue</a>
        </li>
        <li class="sidebar-list-item">
          <a href="{{ url_for('help_page') }}"><i class="fa-solid fa-handshake-angle"></i> Help</a>
        </li>
        <li class="sidebar-list-item">
          <a href="{{ url_for('aboutus') }}"><i class="fa-solid fa-inbox"></i> Aboutus</a>
        </li>
      </ul>
    </aside>

    <!-- Main Content -->
    <main class="main-container p-5 px-[30px] ">
      <h1
        class="text-2xl font-bold mb-8 mt-12 p-4 bg-[rgb(247,246,252)] shadow-[0_6px_7px_-4px_rgba(0,0,0,0.2)] flex gap-2">
        <i class="fa-solid fa-circle-question text-3xl"></i>
        Help & Support
      </h1>
      <div class="flex w-full">


        <div class="w-1/2">
          <!-- Tabs -->
          <div class="mb-6 flex border-b border-gray-200 text-sm font-medium" id="tabs">
            <button data-tab="general"
              class="tab-btn px-4 py-2 text-blue-700 border-b-2 border-blue-700 text-lg">General
              Help</button>
            <button data-tab="escalate"
              class="tab-btn px-4 py-2 text-gray-600 border-b-2 text-lg hover:text-blue-700">Escalate Issue</button>
          </div>


          <!-- General Help Tab -->
          <section id="general" class="tab-section">
            <h2 class="text-lg font-semibold pl-[20px] mb-4">How to Use CityZen</h2>
            <ol class="list-decimal list-inside text-gray-700 pl-[30px]  mb-6">
              <li class="mb-5">Go to the Home page and click <strong>Report an Issue</strong>.</li>
              <li class="mb-5">Upload a photo, enter details, and verify your location.</li>
              <li class="mb-5">Submit the issue and track it from the <strong>Track</strong> section.</li>
              <li class="mb-5">Vote on other issues to help prioritize them.</li>
            </ol>

            <h2 class="text-lg font-semibold pl-[20px] mb-5">Feedback / Query</h2>
            <div class="w-[100%] rounded-[10px] p-5 bg-[rgb(247,246,252)] shadow-[0_6px_7px_-4px_rgba(0,0,0,0.2)]">
              <form id="generalForm" class=" bg-white p-6 rounded-2xl " method="POST" action="/help">
                <div class="mb-4">
                  <label class="block text-md font-medium text-gray-700 mb-1" for="name">Name</label>
                  <input id="name" type="text" name="name"
                    class="w-full rounded-lg p-3 border-gray-300 shadow-sm bg-[rgb(247,246,252)] focus:ring-blue-500 focus:border-blue-500" />
                </div>
                <div class="mb-4">
                  <label class="block text-md font-medium text-gray-700 mb-1" for="email">Email</label>
                  <input id="email" type="email" name="email"
                    class="w-full rounded-lg p-3 border-gray-300 shadow-sm bg-[rgb(247,246,252)] focus:ring-blue-500 focus:border-blue-500" />
                </div>
                <div class="mb-4">
                  <label class="block text-md font-medium text-gray-700 mb-1" for="message">Message</label>
                  <textarea id="message" rows="4" name="message"
                    class="w-full p-4 rounded-lg border-gray-300 shadow-sm bg-[rgb(247,246,252)] focus:ring-blue-500 focus:border-blue-500"></textarea>
                </div>
                <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Submit to
                  Admin</button>
              </form>
            </div>
            <p id="generalConfirm" class="mt-4 text-green-700 font-medium hidden">Thank you! Your feedback has been sent
              to
              the admin.</p>
          </section>

          <!-- Escalate Issue Tab -->
          <section id="escalate" class="tab-section hidden">
            <h2 class="text-lg font-semibold mb-4">Escalate Your Issue</h2>
            <p class="text-gray-700 mb-4">If your reported issue hasnâ€™t been addressed in 5+ days, escalate it here.</p>

            <div class="w-[100%] rounded-[10px] p-5 bg-[rgb(247,246,252)] shadow-[0_6px_7px_-4px_rgba(0,0,0,0.2)] ">
              <form id="escalateForm" class="space-y-4 bg-white p-6 rounded-2xl " method="POST" action="#">
                <input type="hidden" name="form_type" value="escalate">
                <div class="mb-4">
                  <label class="block text-sm font-medium text-gray-700 mb-1" for="issueId">Issue ID</label>
                  <input id="issueId" type="number" name="issue_id"
                    placeholder="For Issue_ID Track Your Issue via Email"
                    class="w-full rounded-lg border-gray-300 p-3 shadow-sm bg-[rgb(247,246,252)] focus:ring-blue-500 focus:border-blue-500" />
                </div>
                <div id="timeWarning" class="hidden text-yellow-700 bg-yellow-100 mb-4 rounded-lg p-3 text-sm"></div>
                <div class="mb-4">
                  <label class="block text-sm font-medium text-gray-700 mb-1" for="escalateMsg">Message</label>
                  <textarea id="escalateMsg" rows="4" name="escalate_msg"
                    class="w-full p-4 rounded-lg border-gray-300 shadow-sm bg-[rgb(247,246,252)] focus:ring-blue-500 focus:border-blue-500"></textarea>
                </div>
                <button id="escalateSubmit" type="submit"
                  class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Submit to High
                  Authority</button>
              </form>
            </div>
            <p id="escalateConfirm" class="mt-4 text-green-700 font-medium hidden">Your escalation request has been sent
              to
              higher authorities.</p>
          </section>
        </div>

        <div class="fixed top-16 right-0 w-1/2 h-full -z-10 pointer-events-none overflow-hidden">
          <iframe src="https://lottie.host/embed/c8e5594f-fb68-4962-ab2a-c1e2dd580050/pjkktYnFFG.lottie"
            class="w-full h-full border-none"></iframe>
        </div>



      </div>


    </main>
  </div>


  <script type="module" src="https://unpkg.com/@lottiefiles/dotlottie-wc@0.6.2/dist/dotlottie-wc.js"></script>
  <script defer>


    const bar = document.getElementById('bar');
    const sidebar = document.getElementById('sidebar');
    const accountBtn = document.getElementById("accountBtn");
    const accountPanel = document.getElementById("accountPanel");

    bar.addEventListener('click', () => {
      sidebar.classList.toggle('active');
      bar.classList.toggle('active1');
    });

    accountBtn.addEventListener("click", () => {
      accountPanel.classList.toggle("show");
    });

    // Tabs
    document.getElementById('tabs').addEventListener('click', (e) => {
      const btn = e.target.closest('.tab-btn');
      if (!btn) return;

      document.querySelectorAll('.tab-btn').forEach(b => {
        const isActive = b === btn;
        b.classList.toggle('text-blue-700', isActive);
        b.classList.toggle('border-blue-700', isActive);
        b.classList.toggle('border-b-2', isActive);
        b.classList.toggle('text-gray-600', !isActive);
      });

      document.querySelectorAll('.tab-section').forEach(sec => {
        sec.classList.toggle('hidden', sec.id !== btn.dataset.tab);
      });
    });


    // Feedback form
    document.getElementById('generalForm').addEventListener('submit', (e) => {

      document.getElementById('generalConfirm').classList.remove('hidden');
    });

    // Escalation form
    document.getElementById('escalateForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const issueId = parseInt(document.getElementById('issueId').value.trim());
      const message = document.getElementById('escalateMsg').value.trim();

      if (!issueId || !message) {
        alert(" Please fill in both Issue ID and Message.");
        return;
      }

      try {
        const res = await fetch(`/get_issue/${issueId}`);
        if (!res.ok) {
          alert("Issue not found.");
          return;
        }

        const data = await res.json();
        const createdDate = new Date(data.created_at);
        const now = new Date();
        const diffDays = (now - createdDate) / (1000 * 60 * 60 * 24);

        if (diffDays < 5) {
          alert(`You reported this issue only ${Math.floor(diffDays)} day(s) ago. Please wait at least 5 days.`);
        } else {
          alert("Your issue has been sent to higher authorities.");
        }

      } catch (err) {
        console.error("Fetch error:", err);
        alert("Something went wrong while checking the issue.");
      }
    });


  </script>
</body>

</html>