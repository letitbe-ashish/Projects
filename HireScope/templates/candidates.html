<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HireScope - All Candidates</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="flex min-h-screen">
       <!--Navbar Toggle-->
        <button id="sidebar-toggle" class="fixed top-4 left-4 z-50 p-2 rounded-md bg-[#3498db] text-white md:hidden">
            <i id="toggle-icon" class="fas fa-bars h-6 w-6"></i>
        </button>
        <!--Navbar-->
        <nav id="sidebar" class="w-64 bg-[#2c3e50] text-white p-0 fixed h-screen overflow-y-auto transform -translate-x-full transition-transform duration-300 ease-in-out md:translate-x-0 md:block z-40 md:h-screen">
            <div class="p-6 border-b border-[#34495e]">
                <img src="./static/images/logo.png" class="w-30 rounded-md" alt="Logo"/>
            </div>
            <ul class="list-none p-0 m-0">
                <li class="border-b border-[#34495e]"><a href="{{ url_for('upload') }}" class="block px-6 py-4 text-[#ecf0f1] no-underline transition-colors hover:bg-[#3498db] "><i class="fa-solid fa-upload"></i> Upload Resume</a></li>
                <li class="border-b border-[#34495e]"><a href="{{ url_for('candidates') }}" class="block px-6 py-4 text-[#ecf0f1] no-underline transition-colors bg-[#3498db] text-white"><i class="fa-solid fa-users"></i> All Candidates</a></li>
                <li class="border-b border-[#34495e]"><a href="{{ url_for('shortlisted') }}" class="block px-6 py-4 text-[#ecf0f1] no-underline transition-colors hover:bg-[#3498db] "><i class="fa-solid fa-check-double"></i> Shortlisted</a></li>
                <li class="border-b border-[#34495e]"><a href="{{ url_for('logout') }}" class="block px-6 py-4 text-[#e74c3c] no-underline transition-colors hover:bg-[#e74c3c] hover: text-white "><i class="fa-solid fa-right-from-bracket"></i> Logout</a></li>
            </ul>
        </nav>

        <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden md:hidden"></div>
        <!--maincontent-->
        <main class="flex-1 p-4 md:ml-64 md:p-8">
            <div class="mb-8">
                <h1 class="text-[#2c3e50] font-bold text-3xl mb-2">All Candidates</h1>
            </div>

            {% if candidates %}
                <div class="mb-8">
                    <div class="flex flex-wrap -mx-2">
                        <div class="w-full md:w-1/3 px-2 mb-4">
                            <div class="bg-white p-6 rounded-lg shadow-md text-center">
                                <h3 class="text-[#3498db] text-4xl font-bold mb-2">{{ candidates|length }}</h3>
                                <p class="text-[#7f8c8d] m-0">Total Candidates</p>
                            </div>
                        </div>
                        <div class="w-full md:w-1/3 px-2 mb-4">
                            <div class="bg-white p-6 rounded-lg shadow-md text-center">
                                <h3 class="text-[#3498db] text-4xl font-bold mb-2">{{ candidates|selectattr('8', 'eq', 1)|list|length }}</h3>
                                <p class="text-[#7f8c8d] m-0">Shortlisted</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mb-8">
                    <form method="GET" action="{{ url_for('candidates') }}" class="flex flex-wrap items-end gap-4">
                        <div class="flex-1 min-w-[200px]">
                            <label for="job_role_filter" class="font-semibold text-[#2c3e50] mb-2 block">Filter by Job Role:</label>
                            <select class="w-full px-4 py-2 border-2 border-[#e9ecef] rounded-lg focus:outline-none focus:border-[#3498db]" id="job_role_filter" name="job_role">
                                <option value="all" {% if not selected_job_role or selected_job_role == 'all' %}selected{% endif %}>All Job Roles</option>
                                {% for role in job_roles %}
                                <option value="{{ role }}" {% if selected_job_role == role %}selected{% endif %}>{{ role }}</option>
                                {% endfor %}
                            </select>
                        </div>
                      
                        <div class="flex-1 min-w-[200px]">
                            <label for="sort_by" class="font-semibold text-[#2c3e50] mb-2 block">Sort By:</label>
                            <select class="w-full px-4 py-2 border-2 border-[#e9ecef] rounded-lg focus:outline-none focus:border-[#3498db]" id="sort_by" name="sort_by">
                                <option value="match_desc" {% if selected_sort_by == 'match_desc' %}selected{% endif %}>Match % (High to Low)</option>
                                <option value="match_asc" {% if selected_sort_by == 'match_asc' %}selected{% endif %}>Match % (Low to High)</option>
                                <option value="date_desc" {% if selected_sort_by == 'date_desc' %}selected{% endif %}>Date (Newest First)</option>
                                <option value="date_asc" {% if selected_sort_by == 'date_asc' %}selected{% endif %}>Date (Oldest First)</option>
                            </select>
                        </div>
                        <div class="w-full md:w-auto">
                            <button type="submit" class="rounded-lg px-6 py-3 font-medium bg-[#3498db] text-white hover:bg-[#2980b9] w-full">Apply</button>
                        </div>
                    </form>
                </div>

                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr>
                                <th class="bg-[#2980B9] text-white border-2 border-[#6ea8cc] p-3 text-sm font-semibold">Name</th>
                                <th class="bg-[#2980B9] text-white border-2 border-[#6ea8cc] p-3 text-sm font-semibold">Skills</th>
                                <th class="bg-[#2980B9] text-white border-2 border-[#6ea8cc] p-3 text-sm font-semibold">Experience</th>
                                <th class="bg-[#2980B9] text-white border-2 border-[#6ea8cc] p-3 text-sm font-semibold">Job Role</th>
                                <th class="bg-[#2980B9] text-white border-2 border-[#6ea8cc] p-3 text-sm font-semibold">Match %</th>
                                <th class="bg-[#2980B9] text-white border-2 border-[#6ea8cc] p-3 text-sm font-semibold">Status</th>
                                <th class="bg-[#2980B9] text-white border-2 border-[#6ea8cc] p-3 text-sm font-semibold">Actions</th>
                                <th class="bg-[#2980B9] text-white border-2 border-[#6ea8cc] p-3 text-sm font-semibold">Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for candidate in candidates %}
                            <tr class="{% if candidate[6] < 40 %}bg-red-200{% elif candidate[6] < 75 %}bg-yellow-100{% else %}bg-green-100{% endif %}">

                                <td class="p-3 align-top border-2 border-black text-[#495057]">
                                    {{ candidate[1] }}
                                    <br>
                                    <small class="text-gray-500">{{ candidate[7] }}</small>
                                </td>
                                <td class="p-3 align-top border-2 border-black text-[#495057]">{{ candidate[2] }}</td>
                                <td class="p-3 align-top border-2 border-black text-[#495057]">{{ candidate[3] }}</td>
                                <td class="p-3 align-top border-2 border-black text-[#495057]">{{ candidate[4] }}</td>
                                <td class="p-3 align-top border-2 border-black text-[#495057]">{{ candidate[6] }}%</td>
                                <td class="p-3 align-top border-2 border-black text-[#495057]">
                                    {% if candidate[8] %}
                                        Shortlisted
                                    {% else %}
                                        Not Shortlisted
                                    {% endif %}
                                </td>
                                <td class="p-3 align-top border-2 border-black text-[#495057] space-y-1">
                                    <a href="{{ url_for('toggle_shortlist', candidate_id=candidate[0]) }}" method="POST" class="text-blue-600 no-underline hover:underline block">
                                        {% if candidate[8] %}
                                            Remove
                                        {% else %}
                                            Shortlist
                                        {% endif %}
                                    </a>
                                    <form action="{{ url_for('delete_candidate', candidate_id=candidate[0]) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this candidate?');">
                                        <button type="submit" class="text-red-600 hover:underline">Delete</button>
                                    </form>
                                </td>
                                <td class="p-3 align-top border-2 border-black text-[#495057]">{{ candidate[9] }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="bg-white p-12 rounded-lg shadow-md text-center">
                    <h3 class="text-[#7f8c8d] mb-4">No candidates found</h3>
                </div>
            {% endif %}
        </main>
    </div>

    <script>
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        const toggleIcon = document.getElementById('toggle-icon');

        function toggleSidebar() {
            sidebar.classList.toggle('-translate-x-full');
            sidebarOverlay.classList.toggle('hidden');
            
            if (sidebar.classList.contains('-translate-x-full')) {
                toggleIcon.classList.remove('fa-times');
                toggleIcon.classList.add('fa-bars');
            } else {
                toggleIcon.classList.remove('fa-bars');
                toggleIcon.classList.add('fa-times');
            }
        }

        sidebarToggle.addEventListener('click', toggleSidebar);
        sidebarOverlay.addEventListener('click', toggleSidebar);
    </script>
</body>
</html>
